package lib.terraform.CB_TFAWS_357

test_aws_cloudfront_web_acl_configured_with_log4j_vulnerability_passed {
	result := passed with input as [
    {
        "Type": "resource",
        "Labels": [
            "aws_cloudfront_distribution",
            "pass"
        ],
        "Attributes": {
            "aliases": [
                "mysite.example.com",
                "yoursite.example.com"
            ],
            "comment": "Some comment",
            "default_root_object": "index.html",
            "enabled": true,
            "is_ipv6_enabled": true,
            "price_class": "PriceClass_200",
            "tags": {
                "Environment": "production"
            },
            "web_acl_id": "aws_wafv2_web_acl.pass_acl.arn"
        },
        "Blocks": [
            {
                "Type": "origin",
                "Labels": [],
                "Attributes": {
                    "domain_name": "aws_s3_bucket.b.bucket_regional_domain_name",
                    "origin_access_control_id": "aws_cloudfront_origin_access_control.default.id",
                    "origin_id": "local.s3_origin_id"
                },
                "Blocks": [],
                "line_range": {
                    "endLine": 6,
                    "startLine": 2
                }
            },
            {
                "Type": "default_cache_behavior",
                "Labels": [],
                "Attributes": {
                    "allowed_methods": [
                        "DELETE",
                        "GET",
                        "HEAD",
                        "OPTIONS",
                        "PATCH",
                        "POST",
                        "PUT"
                    ],
                    "cached_methods": [
                        "GET",
                        "HEAD"
                    ],
                    "default_ttl": "3600",
                    "max_ttl": "86400",
                    "min_ttl": "0",
                    "target_origin_id": "local.s3_origin_id",
                    "viewer_protocol_policy": "allow-all"
                },
                "Blocks": [
                    {
                        "Type": "forwarded_values",
                        "Labels": [],
                        "Attributes": {
                            "query_string": false
                        },
                        "Blocks": [
                            {
                                "Type": "cookies",
                                "Labels": [],
                                "Attributes": {
                                    "forward": "none"
                                },
                                "Blocks": [],
                                "line_range": {
                                    "endLine": 25,
                                    "startLine": 23
                                }
                            }
                        ],
                        "line_range": {
                            "endLine": 26,
                            "startLine": 20
                        }
                    }
                ],
                "line_range": {
                    "endLine": 32,
                    "startLine": 15
                }
            },
            {
                "Type": "ordered_cache_behavior",
                "Labels": [],
                "Attributes": {
                    "allowed_methods": [
                        "GET",
                        "HEAD",
                        "OPTIONS"
                    ],
                    "cached_methods": [
                        "GET",
                        "HEAD",
                        "OPTIONS"
                    ],
                    "compress": true,
                    "default_ttl": "86400",
                    "max_ttl": "3.1536e+07",
                    "min_ttl": "0",
                    "path_pattern": "/content/immutable/*",
                    "target_origin_id": "local.s3_origin_id",
                    "viewer_protocol_policy": "redirect-to-https"
                },
                "Blocks": [
                    {
                        "Type": "forwarded_values",
                        "Labels": [],
                        "Attributes": {
                            "headers": [
                                "Origin"
                            ],
                            "query_string": false
                        },
                        "Blocks": [
                            {
                                "Type": "cookies",
                                "Labels": [],
                                "Attributes": {
                                    "forward": "none"
                                },
                                "Blocks": [],
                                "line_range": {
                                    "endLine": 47,
                                    "startLine": 45
                                }
                            }
                        ],
                        "line_range": {
                            "endLine": 48,
                            "startLine": 41
                        }
                    }
                ],
                "line_range": {
                    "endLine": 55,
                    "startLine": 35
                }
            },
            {
                "Type": "restrictions",
                "Labels": [],
                "Attributes": {},
                "Blocks": [
                    {
                        "Type": "geo_restriction",
                        "Labels": [],
                        "Attributes": {
                            "locations": [
                                "US",
                                "CA",
                                "GB",
                                "DE"
                            ],
                            "restriction_type": "whitelist"
                        },
                        "Blocks": [],
                        "line_range": {
                            "endLine": 63,
                            "startLine": 60
                        }
                    }
                ],
                "line_range": {
                    "endLine": 64,
                    "startLine": 59
                }
            },
            {
                "Type": "viewer_certificate",
                "Labels": [],
                "Attributes": {
                    "cloudfront_default_certificate": true
                },
                "Blocks": [],
                "line_range": {
                    "endLine": 72,
                    "startLine": 70
                }
            }
        ],
        "line_range": {
            "endLine": 74,
            "startLine": 1
        }
    },
    {
        "Type": "resource",
        "Labels": [
            "aws_wafv2_web_acl",
            "pass_acl"
        ],
        "Attributes": {
            "description": "Example of a managed rule.",
            "name": "managed-rule-example",
            "scope": "REGIONAL",
            "tags": {
                "Tag1": "Value1",
                "Tag2": "Value2"
            }
        },
        "Blocks": [
            {
                "Type": "default_action",
                "Labels": [],
                "Attributes": {},
                "Blocks": [
                    {
                        "Type": "allow",
                        "Labels": [],
                        "Attributes": {},
                        "Blocks": [],
                        "line_range": {
                            "endLine": 82,
                            "startLine": 82
                        }
                    }
                ],
                "line_range": {
                    "endLine": 83,
                    "startLine": 81
                }
            },
            {
                "Type": "rule",
                "Labels": [],
                "Attributes": {
                    "name": "rule-1",
                    "priority": "1"
                },
                "Blocks": [
                    {
                        "Type": "override_action",
                        "Labels": [],
                        "Attributes": {},
                        "Blocks": [
                            {
                                "Type": "count",
                                "Labels": [],
                                "Attributes": {},
                                "Blocks": [],
                                "line_range": {
                                    "endLine": 90,
                                    "startLine": 90
                                }
                            }
                        ],
                        "line_range": {
                            "endLine": 91,
                            "startLine": 89
                        }
                    },
                    {
                        "Type": "statement",
                        "Labels": [],
                        "Attributes": {},
                        "Blocks": [
                            {
                                "Type": "managed_rule_group_statement",
                                "Labels": [],
                                "Attributes": {
                                    "name": "AWSManagedRulesAnonymousIpList",
                                    "vendor_name": "AWS"
                                },
                                "Blocks": [
                                    {
                                        "Type": "excluded_rule",
                                        "Labels": [],
                                        "Attributes": {
                                            "name": "SizeRestrictions_QUERYSTRING"
                                        },
                                        "Blocks": [],
                                        "line_range": {
                                            "endLine": 100,
                                            "startLine": 98
                                        }
                                    },
                                    {
                                        "Type": "scope_down_statement",
                                        "Labels": [],
                                        "Attributes": {},
                                        "Blocks": [
                                            {
                                                "Type": "geo_match_statement",
                                                "Labels": [],
                                                "Attributes": {
                                                    "country_codes": [
                                                        "US",
                                                        "NL"
                                                    ]
                                                },
                                                "Blocks": [],
                                                "line_range": {
                                                    "endLine": 105,
                                                    "startLine": 103
                                                }
                                            }
                                        ],
                                        "line_range": {
                                            "endLine": 106,
                                            "startLine": 102
                                        }
                                    }
                                ],
                                "line_range": {
                                    "endLine": 107,
                                    "startLine": 94
                                }
                            }
                        ],
                        "line_range": {
                            "endLine": 108,
                            "startLine": 93
                        }
                    },
                    {
                        "Type": "visibility_config",
                        "Labels": [],
                        "Attributes": {
                            "cloudwatch_metrics_enabled": false,
                            "metric_name": "friendly-rule-metric-name",
                            "sampled_requests_enabled": false
                        },
                        "Blocks": [],
                        "line_range": {
                            "endLine": 114,
                            "startLine": 110
                        }
                    }
                ],
                "line_range": {
                    "endLine": 115,
                    "startLine": 85
                }
            },
            {
                "Type": "rule",
                "Labels": [],
                "Attributes": {
                    "name": "rule-2",
                    "priority": "2"
                },
                "Blocks": [
                    {
                        "Type": "override_action",
                        "Labels": [],
                        "Attributes": {},
                        "Blocks": [
                            {
                                "Type": "count",
                                "Labels": [],
                                "Attributes": {},
                                "Blocks": [],
                                "line_range": {
                                    "endLine": 122,
                                    "startLine": 122
                                }
                            }
                        ],
                        "line_range": {
                            "endLine": 123,
                            "startLine": 121
                        }
                    },
                    {
                        "Type": "statement",
                        "Labels": [],
                        "Attributes": {},
                        "Blocks": [
                            {
                                "Type": "managed_rule_group_statement",
                                "Labels": [],
                                "Attributes": {
                                    "name": "AWSManagedRulesKnownBadInputsRuleSet",
                                    "vendor_name": "AWS"
                                },
                                "Blocks": [
                                    {
                                        "Type": "excluded_rule",
                                        "Labels": [],
                                        "Attributes": {
                                            "name": "SizeRestrictions_QUERYSTRING"
                                        },
                                        "Blocks": [],
                                        "line_range": {
                                            "endLine": 132,
                                            "startLine": 130
                                        }
                                    },
                                    {
                                        "Type": "scope_down_statement",
                                        "Labels": [],
                                        "Attributes": {},
                                        "Blocks": [
                                            {
                                                "Type": "geo_match_statement",
                                                "Labels": [],
                                                "Attributes": {
                                                    "country_codes": [
                                                        "US",
                                                        "NL"
                                                    ]
                                                },
                                                "Blocks": [],
                                                "line_range": {
                                                    "endLine": 137,
                                                    "startLine": 135
                                                }
                                            }
                                        ],
                                        "line_range": {
                                            "endLine": 138,
                                            "startLine": 134
                                        }
                                    }
                                ],
                                "line_range": {
                                    "endLine": 139,
                                    "startLine": 126
                                }
                            }
                        ],
                        "line_range": {
                            "endLine": 140,
                            "startLine": 125
                        }
                    },
                    {
                        "Type": "visibility_config",
                        "Labels": [],
                        "Attributes": {
                            "cloudwatch_metrics_enabled": false,
                            "metric_name": "friendly-rule-metric-name",
                            "sampled_requests_enabled": false
                        },
                        "Blocks": [],
                        "line_range": {
                            "endLine": 146,
                            "startLine": 142
                        }
                    }
                ],
                "line_range": {
                    "endLine": 147,
                    "startLine": 117
                }
            },
            {
                "Type": "visibility_config",
                "Labels": [],
                "Attributes": {
                    "cloudwatch_metrics_enabled": false,
                    "metric_name": "friendly-metric-name",
                    "sampled_requests_enabled": false
                },
                "Blocks": [],
                "line_range": {
                    "endLine": 159,
                    "startLine": 155
                }
            }
        ],
        "line_range": {
            "endLine": 160,
            "startLine": 76
        }
    }
]
	count(result) == 1
}

test_aws_cloudfront_web_acl_configured_with_log4j_vulnerability_failed {
	result := failed with input as [
    {
        "Type": "resource",
        "Labels": [
            "aws_cloudfront_distribution",
            "pass"
        ],
        "Attributes": {
            "aliases": [
                "mysite.example.com",
                "yoursite.example.com"
            ],
            "comment": "Some comment",
            "default_root_object": "index.html",
            "enabled": true,
            "is_ipv6_enabled": true,
            "price_class": "PriceClass_200",
            "tags": {
                "Environment": "production"
            },
            "web_acl_id": "aws_wafv2_web_acl.pass_acl.arn"
        },
        "Blocks": [
            {
                "Type": "origin",
                "Labels": [],
                "Attributes": {
                    "domain_name": "aws_s3_bucket.b.bucket_regional_domain_name",
                    "origin_access_control_id": "aws_cloudfront_origin_access_control.default.id",
                    "origin_id": "local.s3_origin_id"
                },
                "Blocks": [],
                "line_range": {
                    "endLine": 6,
                    "startLine": 2
                }
            },
            {
                "Type": "default_cache_behavior",
                "Labels": [],
                "Attributes": {
                    "allowed_methods": [
                        "DELETE",
                        "GET",
                        "HEAD",
                        "OPTIONS",
                        "PATCH",
                        "POST",
                        "PUT"
                    ],
                    "cached_methods": [
                        "GET",
                        "HEAD"
                    ],
                    "default_ttl": "3600",
                    "max_ttl": "86400",
                    "min_ttl": "0",
                    "target_origin_id": "local.s3_origin_id",
                    "viewer_protocol_policy": "allow-all"
                },
                "Blocks": [
                    {
                        "Type": "forwarded_values",
                        "Labels": [],
                        "Attributes": {
                            "query_string": false
                        },
                        "Blocks": [
                            {
                                "Type": "cookies",
                                "Labels": [],
                                "Attributes": {
                                    "forward": "none"
                                },
                                "Blocks": [],
                                "line_range": {
                                    "endLine": 25,
                                    "startLine": 23
                                }
                            }
                        ],
                        "line_range": {
                            "endLine": 26,
                            "startLine": 20
                        }
                    }
                ],
                "line_range": {
                    "endLine": 32,
                    "startLine": 15
                }
            },
            {
                "Type": "ordered_cache_behavior",
                "Labels": [],
                "Attributes": {
                    "allowed_methods": [
                        "GET",
                        "HEAD",
                        "OPTIONS"
                    ],
                    "cached_methods": [
                        "GET",
                        "HEAD",
                        "OPTIONS"
                    ],
                    "compress": true,
                    "default_ttl": "86400",
                    "max_ttl": "3.1536e+07",
                    "min_ttl": "0",
                    "path_pattern": "/content/immutable/*",
                    "target_origin_id": "local.s3_origin_id",
                    "viewer_protocol_policy": "redirect-to-https"
                },
                "Blocks": [
                    {
                        "Type": "forwarded_values",
                        "Labels": [],
                        "Attributes": {
                            "headers": [
                                "Origin"
                            ],
                            "query_string": false
                        },
                        "Blocks": [
                            {
                                "Type": "cookies",
                                "Labels": [],
                                "Attributes": {
                                    "forward": "none"
                                },
                                "Blocks": [],
                                "line_range": {
                                    "endLine": 47,
                                    "startLine": 45
                                }
                            }
                        ],
                        "line_range": {
                            "endLine": 48,
                            "startLine": 41
                        }
                    }
                ],
                "line_range": {
                    "endLine": 55,
                    "startLine": 35
                }
            },
            {
                "Type": "restrictions",
                "Labels": [],
                "Attributes": {},
                "Blocks": [
                    {
                        "Type": "geo_restriction",
                        "Labels": [],
                        "Attributes": {
                            "locations": [
                                "US",
                                "CA",
                                "GB",
                                "DE"
                            ],
                            "restriction_type": "whitelist"
                        },
                        "Blocks": [],
                        "line_range": {
                            "endLine": 63,
                            "startLine": 60
                        }
                    }
                ],
                "line_range": {
                    "endLine": 64,
                    "startLine": 59
                }
            },
            {
                "Type": "viewer_certificate",
                "Labels": [],
                "Attributes": {
                    "cloudfront_default_certificate": true
                },
                "Blocks": [],
                "line_range": {
                    "endLine": 72,
                    "startLine": 70
                }
            }
        ],
        "line_range": {
            "endLine": 74,
            "startLine": 1
        }
    },
    {
        "Type": "resource",
        "Labels": [
            "aws_wafv2_web_acl",
            "pass_acl"
        ],
        "Attributes": {
            "description": "Example of a managed rule.",
            "name": "managed-rule-example",
            "scope": "REGIONAL",
            "tags": {
                "Tag1": "Value1",
                "Tag2": "Value2"
            }
        },
        "Blocks": [
            {
                "Type": "default_action",
                "Labels": [],
                "Attributes": {},
                "Blocks": [
                    {
                        "Type": "allow",
                        "Labels": [],
                        "Attributes": {},
                        "Blocks": [],
                        "line_range": {
                            "endLine": 82,
                            "startLine": 82
                        }
                    }
                ],
                "line_range": {
                    "endLine": 83,
                    "startLine": 81
                }
            },
            {
                "Type": "rule",
                "Labels": [],
                "Attributes": {
                    "name": "rule-1",
                    "priority": "1"
                },
                "Blocks": [
                    {
                        "Type": "override_action",
                        "Labels": [],
                        "Attributes": {},
                        "Blocks": [
                            {
                                "Type": "count",
                                "Labels": [],
                                "Attributes": {},
                                "Blocks": [],
                                "line_range": {
                                    "endLine": 90,
                                    "startLine": 90
                                }
                            }
                        ],
                        "line_range": {
                            "endLine": 91,
                            "startLine": 89
                        }
                    },
                    {
                        "Type": "statement",
                        "Labels": [],
                        "Attributes": {},
                        "Blocks": [
                            {
                                "Type": "managed_rule_group_statement",
                                "Labels": [],
                                "Attributes": {
                                    "name": "",
                                    "vendor_name": "AWS"
                                },
                                "Blocks": [
                                    {
                                        "Type": "excluded_rule",
                                        "Labels": [],
                                        "Attributes": {
                                            "name": "SizeRestrictions_QUERYSTRING"
                                        },
                                        "Blocks": [],
                                        "line_range": {
                                            "endLine": 100,
                                            "startLine": 98
                                        }
                                    },
                                    {
                                        "Type": "scope_down_statement",
                                        "Labels": [],
                                        "Attributes": {},
                                        "Blocks": [
                                            {
                                                "Type": "geo_match_statement",
                                                "Labels": [],
                                                "Attributes": {
                                                    "country_codes": [
                                                        "US",
                                                        "NL"
                                                    ]
                                                },
                                                "Blocks": [],
                                                "line_range": {
                                                    "endLine": 105,
                                                    "startLine": 103
                                                }
                                            }
                                        ],
                                        "line_range": {
                                            "endLine": 106,
                                            "startLine": 102
                                        }
                                    }
                                ],
                                "line_range": {
                                    "endLine": 107,
                                    "startLine": 94
                                }
                            }
                        ],
                        "line_range": {
                            "endLine": 108,
                            "startLine": 93
                        }
                    },
                    {
                        "Type": "visibility_config",
                        "Labels": [],
                        "Attributes": {
                            "cloudwatch_metrics_enabled": false,
                            "metric_name": "friendly-rule-metric-name",
                            "sampled_requests_enabled": false
                        },
                        "Blocks": [],
                        "line_range": {
                            "endLine": 114,
                            "startLine": 110
                        }
                    }
                ],
                "line_range": {
                    "endLine": 115,
                    "startLine": 85
                }
            },
            {
                "Type": "rule",
                "Labels": [],
                "Attributes": {
                    "name": "rule-2",
                    "priority": "2"
                },
                "Blocks": [
                    {
                        "Type": "override_action",
                        "Labels": [],
                        "Attributes": {},
                        "Blocks": [
                            {
                                "Type": "count",
                                "Labels": [],
                                "Attributes": {},
                                "Blocks": [],
                                "line_range": {
                                    "endLine": 122,
                                    "startLine": 122
                                }
                            }
                        ],
                        "line_range": {
                            "endLine": 123,
                            "startLine": 121
                        }
                    },
                    {
                        "Type": "statement",
                        "Labels": [],
                        "Attributes": {},
                        "Blocks": [
                            {
                                "Type": "managed_rule_group_statement",
                                "Labels": [],
                                "Attributes": {
                                    "name": "",
                                    "vendor_name": "AWS"
                                },
                                "Blocks": [
                                    {
                                        "Type": "excluded_rule",
                                        "Labels": [],
                                        "Attributes": {
                                            "name": "SizeRestrictions_QUERYSTRING"
                                        },
                                        "Blocks": [],
                                        "line_range": {
                                            "endLine": 132,
                                            "startLine": 130
                                        }
                                    },
                                    {
                                        "Type": "scope_down_statement",
                                        "Labels": [],
                                        "Attributes": {},
                                        "Blocks": [
                                            {
                                                "Type": "geo_match_statement",
                                                "Labels": [],
                                                "Attributes": {
                                                    "country_codes": [
                                                        "US",
                                                        "NL"
                                                    ]
                                                },
                                                "Blocks": [],
                                                "line_range": {
                                                    "endLine": 137,
                                                    "startLine": 135
                                                }
                                            }
                                        ],
                                        "line_range": {
                                            "endLine": 138,
                                            "startLine": 134
                                        }
                                    }
                                ],
                                "line_range": {
                                    "endLine": 139,
                                    "startLine": 126
                                }
                            }
                        ],
                        "line_range": {
                            "endLine": 140,
                            "startLine": 125
                        }
                    },
                    {
                        "Type": "visibility_config",
                        "Labels": [],
                        "Attributes": {
                            "cloudwatch_metrics_enabled": false,
                            "metric_name": "friendly-rule-metric-name",
                            "sampled_requests_enabled": false
                        },
                        "Blocks": [],
                        "line_range": {
                            "endLine": 146,
                            "startLine": 142
                        }
                    }
                ],
                "line_range": {
                    "endLine": 147,
                    "startLine": 117
                }
            },
            {
                "Type": "visibility_config",
                "Labels": [],
                "Attributes": {
                    "cloudwatch_metrics_enabled": false,
                    "metric_name": "friendly-metric-name",
                    "sampled_requests_enabled": false
                },
                "Blocks": [],
                "line_range": {
                    "endLine": 159,
                    "startLine": 155
                }
            }
        ],
        "line_range": {
            "endLine": 160,
            "startLine": 76
        }
    }
]
	count(result) == 1
}